function updateBasketTable(t,e){var a,s,i,l,r,n,o,_,u,c,d,p,T,A,b,m,B,y,E,X,v,h,I,S,f,k,D,N,P,C,g,U,O,R,L,Q,M,x,Y,w,F,H,K,V,j=BX("basket_items"),W=!1,G=!1,J=!1,q=!1;if(j&&"object"==typeof e){if(a=j.rows,l=a[a.length-1],o="Y"===e.PARAMS.QUANTITY_FLOAT,null!==t&&e.BASKET_DATA&&(_=BX(t),s=e.BASKET_ID,(V=BX.type.isPlainObject(e.BASKET_DATA.GRID.ROWS[s]))&&(i=e.BASKET_DATA.GRID.ROWS[s],(r=document.createElement("tr")).setAttribute("id",e.BASKET_ID),r.setAttribute("data-item-name",i.NAME),r.setAttribute("data-item-brand",i[basketJSParams.BRAND_PROPERTY+"_VALUE"]),r.setAttribute("data-item-price",i.PRICE),r.setAttribute("data-item-currency",i.CURRENCY),l.parentNode.insertBefore(r,_.nextSibling)),"Y"===e.DELETE_ORIGINAL&&_.parentNode.removeChild(_),V)){for(r.insertCell(-1).setAttribute("class","margin"),n=e.COLUMNS.split(","),u=0;u<n.length;u++)"DELETE"===n[u]?W=!0:"DELAY"===n[u]?G=!0:"PROPS"===n[u]?J=!0:"TYPE"===n[u]&&(q=!0);for(u=0;u<n.length;u++)switch(n[u]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":if(c=r.insertCell(-1),d="",p="",c.setAttribute("class","itemphoto"),d=i.PREVIEW_PICTURE_SRC.length>0?i.PREVIEW_PICTURE_SRC:i.DETAIL_PICTURE_SRC.length>0?i.DETAIL_PICTURE_SRC:basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.jpg",p=i.DETAIL_PAGE_URL.length>0?'<div class="bx_ordercart_photo_container">\t\t\t\t\t\t\t<a href="'+i.DETAIL_PAGE_URL+'">\t\t\t\t\t\t\t\t<div class="bx_ordercart_photo" style="background-image:url(\''+d+"')\"></div>\t\t\t\t\t\t\t</a>\t\t\t\t\t\t</div>":'<div class="bx_ordercart_photo_container">\t\t\t\t\t\t\t<div class="bx_ordercart_photo" style="background-image:url(\''+d+"')\"></div>\t\t\t\t\t\t</div>",i.BRAND&&i.BRAND.length>0&&(p+='<div class="bx_ordercart_brand">\t\t\t\t\t\t\t<img alt="" src="'+i.BRAND+'"/>\t\t\t\t\t\t</div>'),c.innerHTML=p,T=r.insertCell(-1),A="",T.setAttribute("class","item"),i.DETAIL_PAGE_URL.length>0?A+='<h2 class="bx_ordercart_itemtitle"><a href="'+i.DETAIL_PAGE_URL+'">'+i.NAME+"</a></h2>":A+='<h2 class="bx_ordercart_itemtitle">'+i.NAME+"</h2>",A+='<div class="bx_ordercart_itemart">',J)for(m=0;m<i.PROPS.length;m++){if(B=i.PROPS[m],i.SKU_DATA){b=!1;for(y in i.SKU_DATA)if(i.SKU_DATA.hasOwnProperty(y)&&(E=i.SKU_DATA[y]).CODE===B.CODE){b=!0;break}if(b)continue}A+=BX.util.htmlspecialchars(B.NAME)+":&nbsp;<span>"+B.VALUE+"</span><br/>"}if(A+="</div>",i.SKU_DATA){for(w={},k=0;k<i.PROPS.length;k++)w[(D=i.PROPS[k]).CODE]=BX.type.isNotEmptyString(D["~VALUE"])?D["~VALUE"]:D.VALUE;for(y in i.SKU_DATA)if(i.SKU_DATA.hasOwnProperty(y)){F=0,E=i.SKU_DATA[y],X=!1,v=BX.util.array_keys(E.VALUES).length>5?"full":"",H=0;for(I in E.VALUES)H++,h=E.VALUES[I],BX.type.isNotEmptyString(w[E.CODE])&&(w[E.CODE]!=h.NAME&&w[E.CODE]!=h.XML_ID||(F=H)),h&&"object"==typeof h&&h.PICT&&(X=!0);if(K="0",""!=v&&F>5&&(K=20*(5-F)+"%"),X){A+='<div class="bx_item_detail_scu_small_noadaptive '+v+'">',A+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(E.NAME)+"</span>",A+='<div class="bx_scu_scroller_container">',A+='<div class="bx_scu">',A+='<ul id="prop_'+E.CODE+"_"+i.ID+'" style="width: 200%; margin-left: '+K+';" class="sku_prop_list">',H=0;for(f in E.VALUES)H++,S=E.VALUES[f],A+='<li style="width:10%;"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass="sku_prop'+(F==H?" bx_active":"")+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+S.XML_ID+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(S.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+i.ID+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+E.CODE+'"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript:void(0)" class="cnt"><span class="cnt_item" style="background-image:url('+S.PICT.SRC+'"></span></a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>';A+="</ul>",A+="</div>",A+='<div class="bx_slide_left" onclick="leftScroll(\''+E.CODE+"', "+i.ID+", "+BX.util.array_keys(E.VALUES).length+');"></div>',A+='<div class="bx_slide_right" onclick="rightScroll(\''+E.CODE+"', "+i.ID+", "+BX.util.array_keys(E.VALUES).length+');"></div>',A+="</div>",A+="</div>"}else{A+='<div class="bx_item_detail_size_small_noadaptive '+v+'">',A+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(E.NAME)+"</span>",A+='<div class="bx_size_scroller_container">',A+='<div class="bx_size">',A+='<ul id="prop_'+E.CODE+"_"+i.ID+'" style="width: 200%; margin-left: '+K+';" class="sku_prop_list">',H=0;for(f in E.VALUES)H++,S=E.VALUES[f],A+='<li style="width:10%;"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass="sku_prop '+(F==H?" bx_active":"")+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+("S"===E.TYPE&&"directory"===E.USER_TYPE?S.XML_ID:BX.util.htmlspecialchars(S.NAME))+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(S.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+i.ID+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+E.CODE+'" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript:void(0)" class="cnt">'+BX.util.htmlspecialchars(S.NAME)+"</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>";A+="</ul>",A+="</div>",A+='<div class="bx_slide_left" onclick="leftScroll(\''+E.CODE+"', "+i.ID+", "+BX.util.array_keys(E.VALUES).length+');"></div>',A+='<div class="bx_slide_right" onclick="rightScroll(\''+E.CODE+"', "+i.ID+", "+BX.util.array_keys(E.VALUES).length+');"></div>',A+="</div>",A+="</div>"}}}T.innerHTML=A;break;case"QUANTITY":N=r.insertCell(-1),P="",g=!1,0!=(C=parseFloat(i.MEASURE_RATIO)>0?i.MEASURE_RATIO:1)&&""!=C&&(U=i.QUANTITY,i.QUANTITY=getCorrectRatioQuantity(i.QUANTITY,C,o),U!=i.QUANTITY&&(g=!0)),N.setAttribute("class","custom"),P+="<span>"+getColumnName(e,n[u])+":</span>",P+='<div class="product-item-detail-amount product-item-amount dropdown">',P+='<div class="btn btn-lg btn-gray dropdown-toggle" data-toggle="dropdown" style="position:relative;">',P+='<input class="product-item-amount-field" type="text" id="QUANTITY_INPUT_'+i.ID+'" name="QUANTITY_INPUT_'+i.ID+'" maxlength="18" value="'+i.QUANTITY+'" onchange="updateQuantity(\'QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+C+", "+o+')">',P+='<div style="display: inline" class="product-item-amount-measure">'+BX.util.htmlspecialchars(i.MEASURE_TEXT)+"</div>",P+="</div>",P+='<ul class="dropdown-menu">';for(var z=1;z<10;z++)P+='<li><a class="product-item-amount-custom" href="javascript:;">'+z+"</a></li>";P+="</ul>",P+="</div>",N.innerHTML=P,g&&updateQuantity("QUANTITY_INPUT_"+i.ID,i.ID,C,o);break;case"PRICE":O=r.insertCell(-1),R=i.DISCOUNT_PRICE_PERCENT>0?i.FULL_PRICE_FORMATED:"",O.setAttribute("class","price"),i.DISCOUNT_PRICE_PERCENT>0?O.innerHTML='<div class="product-item-price-current discount" id="current_price_'+i.ID+'">'+i.PRICE_FORMATED+'</div><div class="product-item-price-old" id="old_price_'+i.ID+'">'+R+"</div>":O.innerHTML='<div class="product-item-price-current" id="current_price_'+i.ID+'">'+i.PRICE_FORMATED+"</div>",q&&i.NOTES.length>0&&(O.innerHTML+='<div class="type_price">'+basketJSParams.SALE_TYPE+"</div>",O.innerHTML+='<div class="type_price_value">'+i.NOTES+"</div>");break;case"DISCOUNT":(Q=r.insertCell(-1)).setAttribute("class","custom"),Q.innerHTML="<span>"+getColumnName(e,n[u])+":</span>",Q.innerHTML+='<div id="discount_value_'+i.ID+'">'+i.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>";break;case"WEIGHT":(M=r.insertCell(-1)).setAttribute("class","custom"),M.innerHTML="<span>"+getColumnName(e,n[u])+":</span>",M.innerHTML+=i.WEIGHT_FORMATED;break;default:Y="",(x=r.insertCell(-1)).setAttribute("class","custom"),x.innerHTML="<span>"+getColumnName(e,n[u])+":</span>","SUM"==n[u]&&(Y+='<div class="product-item-price-current" id="sum_'+i.ID+'">'),void 0!==i[n[u]]&&(Y+=i[n[u]]),"SUM"==n[u]&&(Y+="</div>"),x.innerHTML+=Y}if(W||G){var $=r.insertCell(-1);$.setAttribute("class","control"),W&&($.innerHTML='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",i.ID)+'">'+basketJSParams.SALE_DELETE+"</a><br />"),G&&($.innerHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",i.ID)+'">'+basketJSParams.SALE_DELAY+"</a>")}r.insertCell(-1).setAttribute("class","margin")}if(e.BASKET_DATA)for(L in e.BASKET_DATA.GRID.ROWS)if(e.BASKET_DATA.GRID.ROWS.hasOwnProperty(L)){var Z=e.BASKET_DATA.GRID.ROWS[L];BX("discount_value_"+L)&&(BX("discount_value_"+L).innerHTML=Z.DISCOUNT_PRICE_PERCENT_FORMATED),BX("current_price_"+L)&&(BX("current_price_"+L).innerHTML=Z.PRICE_FORMATED),BX("old_price_"+L)&&(BX("old_price_"+L).innerHTML=Z.DISCOUNT_PRICE_PERCENT>0?Z.FULL_PRICE_FORMATED:""),BX("sum_"+L)&&(BX("sum_"+L).innerHTML=Z.SUM),BX("QUANTITY_"+L)&&(BX("QUANTITY_INPUT_"+L).value=Z.QUANTITY,BX("QUANTITY_INPUT_"+L).defaultValue=Z.QUANTITY,BX("QUANTITY_"+L).value=Z.QUANTITY)}if(e.BASKET_DATA&&couponListUpdate(e.BASKET_DATA),e.hasOwnProperty("WARNING_MESSAGE")){var tt="";for(u=e.WARNING_MESSAGE.length-1;u>=0;u--)tt+=e.WARNING_MESSAGE[u]+"<br/>";BX("warning_message").innerHTML=tt}if(e.BASKET_DATA){if(BX("allWeight_FORMATED")&&(BX("allWeight_FORMATED").innerHTML=e.BASKET_DATA.allWeight_FORMATED.replace(/\s/g,"&nbsp;")),BX("allSum_wVAT_FORMATED")&&(BX("allSum_wVAT_FORMATED").innerHTML=e.BASKET_DATA.allSum_wVAT_FORMATED.replace(/\s/g,"&nbsp;")),BX("allVATSum_FORMATED")&&(BX("allVATSum_FORMATED").innerHTML=e.BASKET_DATA.allVATSum_FORMATED.replace(/\s/g,"&nbsp;")),BX("allSum_FORMATED")&&(BX("allSum_FORMATED").innerHTML=e.BASKET_DATA.allSum_FORMATED.replace(/\s/g,"&nbsp;")),BX("PRICE_WITHOUT_DISCOUNT")){var et=e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT!=e.BASKET_DATA.allSum_FORMATED;BX("PRICE_WITHOUT_DISCOUNT").innerHTML=et?e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT.replace(/\s/g,"&nbsp;"):"",BX.style(BX("PRICE_WITHOUT_DISCOUNT").parentNode,"display",et?"table-row":"none")}BX.onCustomEvent("OnBasketChange")}}}function couponCreate(t,e){var a="disabled";BX.type.isElementNode(t)&&("BAD"===e.JS_STATUS?a="bad":"APPLYED"===e.JS_STATUS&&(a="good"),t.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:a,type:"text",value:e.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:!0,readonly:!0}}),BX.create("span",{props:{className:a},attrs:{"data-coupon":e.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:e.JS_CHECK_CODE})]})))}function couponListUpdate(t){var e,a,s,i,l,r,n,o;if(!t||"object"==typeof t){if((e=BX("coupons_block"))&&t.COUPON_LIST&&BX.type.isArray(t.COUPON_LIST))if((s=BX("coupon"))&&(s.value=""),i=BX.findChildren(e,{tagName:"input",property:{name:"OLD_COUPON[]"}},!0)){for(BX.type.isElementNode(i)&&(i=[i]),r=0;r<t.COUPON_LIST.length;r++){for(l=!1,o=-1,n=0;n<i.length;n++)if(i[n].value===t.COUPON_LIST[r].COUPON){l=!0,o=n,i[n].couponUpdate=!0;break}l?(a="disabled","BAD"===t.COUPON_LIST[r].JS_STATUS?a="bad":"APPLYED"===t.COUPON_LIST[r].JS_STATUS&&(a="good"),BX.adjust(i[o],{props:{className:a}}),BX.adjust(i[o].nextSibling,{props:{className:a}}),BX.adjust(i[o].nextSibling.nextSibling,{html:t.COUPON_LIST[r].JS_CHECK_CODE})):couponCreate(e,t.COUPON_LIST[r])}for(n=0;n<i.length;n++)void 0!==i[n].couponUpdate&&i[n].couponUpdate?i[n].couponUpdate=null:(BX.remove(i[n].parentNode),i[n]=null)}else for(r=0;r<t.COUPON_LIST.length;r++)couponCreate(e,t.COUPON_LIST[r]);e=null}}function skuPropClickHandler(){var t,e,a,s,i,l,r,n={},o={};if(this&&this.hasAttribute("data-value-id")){if(BX.showWait(),t=this.getAttribute("data-element"),e=this.getAttribute("data-property"),a=BX("action_var").value,n[e]=BX.util.htmlspecialcharsback(this.getAttribute("data-value-id")),BX.hasClass(this,"bx_active"))return void BX.closeWait();if((s=BX.findChildren(BX(t),{tagName:"ul",className:"sku_prop_list"},!0))&&s.length>0)for(i=0;s.length>i;i++)if(s[i].id!=="prop_"+e+"_"+t&&(l=BX.findChildren(BX(s[i].id),{tagName:"li",className:"bx_active"},!0))&&l.length>0)for(r=0;l.length>r;r++)l[r].hasAttribute("data-value-id")&&(n[l[r].getAttribute("data-property")]=BX.util.htmlspecialcharsback(l[r].getAttribute("data-value-id")));(o={basketItemId:t,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:n,action_var:a,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value})[a]="select_item",BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:o,dataType:"json",onsuccess:function(e){BX.closeWait(),updateBasketTable(t,e)}})}}function getColumnName(t,e){return BX("col_"+e)?BX.util.trim(BX("col_"+e).innerHTML):""}function leftScroll(t,e,a){a=parseInt(a,10);var s=BX("prop_"+t+"_"+e);if(s){var i=parseInt(s.style.marginLeft,10);i<=-20&&(s.style.marginLeft=i+20+"%")}}function rightScroll(t,e,a){a=parseInt(a,10);var s=BX("prop_"+t+"_"+e);if(s){var i=parseInt(s.style.marginLeft,10);i>20*(5-a)&&(s.style.marginLeft=i-20+"%")}}function checkOut(){return BX("coupon")&&(BX("coupon").disabled=!0),BX("basket_form").submit(),!0}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var t=BX("coupon");t&&t.value&&recalcBasketAjax({coupon:t.value})}function updateQuantity(t,e,a,s){var i=BX(t).defaultValue,l=parseFloat(BX(t).value)||0,r=!1,n=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation");if(0===a||1==a)r=!0;else{var o=1e4*l%(1e4*a);parseInt(l);0===o&&(r=!0)}var _=!1;parseInt(l)!=parseFloat(l)&&(_=!0),l=correctQuantity(l=!1===s&&!1===_?parseInt(l):parseFloat(l).toFixed(4)),r?(BX(t).defaultValue=l,BX("QUANTITY_INPUT_"+e).value=l,BX("QUANTITY_"+e).value=l,n&&basketPoolQuantity.changeQuantity(e)):(l=correctQuantity(l=getCorrectRatioQuantity(l,a,s)))!=i?(BX("QUANTITY_INPUT_"+e).value=l,BX("QUANTITY_"+e).value=l,n&&basketPoolQuantity.changeQuantity(e)):BX(t).value=i}function setQuantity(t,e,a,s){var i,l=parseFloat(BX("QUANTITY_INPUT_"+t).value);(i="up"==a?l+e:l-e)<0&&(i=0),s&&(i=parseFloat(i).toFixed(4)),i=correctQuantity(i),e>0&&i<e&&(i=e),s||i==i.toFixed(4)||(i=parseFloat(i).toFixed(4)),i=correctQuantity(i=getCorrectRatioQuantity(i,e,s)),BX("QUANTITY_INPUT_"+t).value=i,BX("QUANTITY_INPUT_"+t).defaultValue=i,updateQuantity("QUANTITY_INPUT_"+t,t,e,s)}function getCorrectRatioQuantity(t,e,a){var s,i=(t/e-(t/e).toFixed(0)).toFixed(6),l=t,r=!1;if(e=parseFloat(e),0==i)return l;if(0!==e&&1!=e)for(s=e,max=parseFloat(t)+parseFloat(e);s<=max;s=parseFloat(parseFloat(s)+parseFloat(e)).toFixed(4))l=s;else 1===e&&(l=0|t);return parseInt(l,10)!=parseFloat(l)&&(r=!0),l=!1===a&&!1===r?parseInt(l,10):parseFloat(l).toFixed(4),l=correctQuantity(l)}function correctQuantity(t){return parseFloat((1*t).toString())}function recalcBasketAjax(t){if(basketPoolQuantity.isProcessing())return!1;BX.showWait();var e,a,s=BX("action_var").value,i=BX("basket_items"),l=BX("delayed_items");if(e={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:{},action_var:s,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value},e[s]="recalculate",t&&"object"==typeof t)for(a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);if(i&&i.rows.length>0)for(a=1;i.rows.length>a;a++)e["QUANTITY_"+i.rows[a].id]=BX("QUANTITY_"+i.rows[a].id).value;if(l&&l.rows.length>0)for(a=1;l.rows.length>a;a++)e["DELAY_"+l.rows[a].id]="Y";basketPoolQuantity.setProcessing(!0),basketPoolQuantity.clearPool(),BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:e,dataType:"json",onsuccess:function(e){BX.closeWait(),basketPoolQuantity.setProcessing(!1),t.coupon&&e&&e.BASKET_DATA&&e.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS&&BX.reload(),basketPoolQuantity.isPoolEmpty()?(updateBasketTable(null,e),basketPoolQuantity.updateQuantity()):basketPoolQuantity.enableTimer(!0)}})}function showBasketItemsList(t){BX.removeClass(BX("basket_toolbar_button"),"btn-primary"),BX.removeClass(BX("basket_toolbar_button_delayed"),"btn-primary"),BX.removeClass(BX("basket_toolbar_button_subscribed"),"btn-primary"),BX.removeClass(BX("basket_toolbar_button_not_available"),"btn-primary"),BX("normal_count").style.display="inline-block",BX("delay_count").style.display="inline-block",BX("subscribe_count").style.display="inline-block",BX("not_available_count").style.display="inline-block",2==t?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="block",BX.addClass(BX("basket_toolbar_button_delayed"),"btn-primary"),BX("delay_count").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none")):3==t?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="block",BX.addClass(BX("basket_toolbar_button_subscribed"),"btn-primary"),BX("subscribe_count").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none")):4==t?(BX("basket_items_list")&&(BX("basket_items_list").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="block",BX.addClass(BX("basket_toolbar_button_not_available"),"btn-primary"),BX("not_available_count").style.display="none")):(BX("basket_items_list")&&(BX("basket_items_list").style.display="block",BX.addClass(BX("basket_toolbar_button"),"btn-primary"),BX("normal_count").style.display="none"),BX("basket_items_delayed")&&(BX("basket_items_delayed").style.display="none"),BX("basket_items_subscribed")&&(BX("basket_items_subscribed").style.display="none"),BX("basket_items_not_available")&&(BX("basket_items_not_available").style.display="none"))}function deleteCoupon(){var t;BX.type.isElementNode(this)&&this.hasAttribute("data-coupon")&&(t=this.getAttribute("data-coupon"),BX.type.isNotEmptyString(t)&&recalcBasketAjax({delete_coupon:t}))}function deleteProductRow(t){var e,a,s=BX.findParent(t,{tagName:"TR"});return s&&(e=BX("QUANTITY_"+s.id))&&(a=getCurrentItemAnalyticsInfo(s,e.value)),setAnalyticsDataLayer([],[a]),document.location.href=t.href,!1}function checkAnalytics(t,e){if(t&&e&&0!==BX.util.array_values(t).length){var a,s,i,l={},r=[],n=[];if(e&&e.rows.length)for(i=1;e.rows.length>i;i++)a=e.rows[i].id,0!=(s=BX("QUANTITY_"+a).value-t[a])&&(l=getCurrentItemAnalyticsInfo(e.rows[i],s),s>0?r.push(l):n.push(l));(r.length||n.length)&&setAnalyticsDataLayer(r,n)}}function getCurrentItemAnalyticsInfo(t,e){if(t){var a,s,i=[],l={name:t.getAttribute("data-item-name")||"",id:t.id,price:t.getAttribute("data-item-price")||0,brand:(t.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(e)};for(a=t.querySelectorAll(".bx_active[data-sku-name]"),s=0;s<a.length;s++)i.push(a[s].getAttribute("data-sku-name"));return l.variant=i.join("/"),l}}function setAnalyticsDataLayer(t,e){window[basketJSParams.DATA_LAYER_NAME]=window[basketJSParams.DATA_LAYER_NAME]||[],t&&t.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:t}}}),e&&e.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:e}}})}function getCurrencyCode(){var t,e=BX("basket_items"),a="";return e&&(t=e.querySelector("[data-item-currency"))&&(a=t.getAttribute("data-item-currency")),a}BasketPoolQuantity=function(){this.processing=!1,this.poolQuantity={},this.updateTimer=null,this.currentQuantity={},this.lastStableQuantities={},this.updateQuantity()},BasketPoolQuantity.prototype.updateQuantity=function(){var t=BX("basket_items");if("Y"===basketJSParams.USE_ENHANCED_ECOMMERCE&&checkAnalytics(this.lastStableQuantities,t),t&&t.rows.length>0)for(var e=1;t.rows.length>e;e++){var a=t.rows[e].id;this.currentQuantity[a]=BX("QUANTITY_"+a).value}this.lastStableQuantities=BX.clone(this.currentQuantity,!0)},BasketPoolQuantity.prototype.changeQuantity=function(t){var e=BX("QUANTITY_"+t).value,a=this.isPoolEmpty();this.currentQuantity[t]&&this.currentQuantity[t]!=e&&(this.poolQuantity[t]=this.currentQuantity[t]=e),a?this.trySendPool():this.enableTimer(!0)},BasketPoolQuantity.prototype.trySendPool=function(){this.isPoolEmpty()||this.isProcessing()||(this.enableTimer(!1),recalcBasketAjax({}))},BasketPoolQuantity.prototype.isPoolEmpty=function(){return 0==Object.keys(this.poolQuantity).length},BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}},BasketPoolQuantity.prototype.isProcessing=function(){return!0===this.processing},BasketPoolQuantity.prototype.setProcessing=function(t){this.processing=!0===t},BasketPoolQuantity.prototype.enableTimer=function(t){clearTimeout(this.updateTimer),!1!==t&&(this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500))},BX.ready(function(){basketPoolQuantity=new BasketPoolQuantity;var t=BX("coupons_block"),e=BX("basket_items");clearButton=BX("clear_button"),BX.type.isElementNode(t)&&BX.bindDelegate(t,"click",{attribute:"data-coupon"},deleteCoupon),BX.type.isElementNode(e)&&BX.bindDelegate(e,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler),BX.type.isNotEmptyString(basketJSParams.EVENT_ONCHANGE_ON_START)&&"Y"==basketJSParams.EVENT_ONCHANGE_ON_START&&BX.onCustomEvent("OnBasketChange"),BX.bind(clearButton,"click",function(){for(var t=e.rows,a=[],s=0;s<t.length;s++)t[s].id&&a.push(t[s].id);a.length>0&&Basket.clear(a).then(function(){BX.reload()})}),$(e).on("click",".product-item-detail-amount .dropdown-menu > li",function(){var t=$(this);t.hasClass("product-item-amount-var")?t.closest(".product-item-amount").find(".product-item-amount-field").val(t.text()).change():t.closest(".product-item-amount").find(".product-item-amount-field").val("").focus()})});